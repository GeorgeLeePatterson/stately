{
  "openapi": "3.1.0",
  "info": {
    "title": "stately-arrow",
    "description": "Arrow backend utilities for viewing data over API",
    "version": "0.3.2"
  },
  "paths": {
    "/catalogs": {
      "get": {
        "summary": "List all catalogs in `Datafusion`",
        "description": "# Errors\n- Internal server error",
        "operationId": "list_catalogs",
        "responses": {
          "200": {
            "description": "List of registered catalogs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        }
      }
    },
    "/connectors": {
      "get": {
        "summary": "List all available connectors",
        "description": "# Errors\n- Internal server error",
        "operationId": "list_connectors",
        "responses": {
          "200": {
            "description": "List of available connections",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ConnectionMetadata"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "List databases or tables/files available in a set of connectors's underlying data stores",
        "description": "# Errors\n- Connector not found\n- Internal server error",
        "operationId": "connector_list_many",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConnectionDetailsRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "List of databases or tables/files keyed by connection",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConnectionDetailsResponse"
                }
              }
            }
          },
          "404": {
            "description": "Connector not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        }
      }
    },
    "/connectors/{connector_id}": {
      "get": {
        "summary": "List databases or tables/files available in a connector's underlying data store",
        "description": "# Errors\n- Connector not found\n- Internal server error",
        "operationId": "connector_list",
        "parameters": [
          {
            "name": "connector_id",
            "in": "path",
            "description": "Connector ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "search",
            "in": "query",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of databases or tables/files",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListSummary"
                }
              }
            }
          },
          "404": {
            "description": "Connector not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        }
      }
    },
    "/query": {
      "post": {
        "summary": "Execute a SQL query using URL tables",
        "description": "# Errors\n- Connector not found\n- Internal server error",
        "operationId": "execute_query",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/QueryRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Query results as Arrow IPC stream",
            "content": {
              "application/vnd.apache.arrow.stream": {}
            }
          },
          "400": {
            "description": "Invalid query",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "404": {
            "description": "Connector not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        }
      }
    },
    "/register": {
      "get": {
        "summary": "List all registered connections",
        "description": "# Errors\n- Internal server error",
        "operationId": "list_registered",
        "responses": {
          "200": {
            "description": "List of registered connections",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ConnectionMetadata"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        }
      }
    },
    "/register/{connector_id}": {
      "get": {
        "summary": "Register a connector. Useful when federating queries since registration is lazy",
        "description": "# Errors\n- Connector not found\n- Internal server error",
        "operationId": "register",
        "parameters": [
          {
            "name": "connector_id",
            "in": "path",
            "description": "Connector ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Registered Connections",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ConnectionMetadata"
                  }
                }
              }
            }
          },
          "404": {
            "description": "Connector not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ApiError": {
        "type": "object",
        "description": "Standard error shape returned by handlers",
        "required": [
          "error",
          "status"
        ],
        "properties": {
          "error": {
            "type": "string"
          },
          "status": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          }
        }
      },
      "BackendMetadata": {
        "type": "object",
        "description": "Static metadata describing a backend connection.\n\nA backend is the underlying implementation of a connector/connection. For this reason, the\nbackend provides its capabilities, kind, and catalog.",
        "required": [
          "kind",
          "capabilities"
        ],
        "properties": {
          "capabilities": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Capability"
            },
            "description": "A list of capabilities the connector supports."
          },
          "kind": {
            "$ref": "#/components/schemas/ConnectionKind",
            "description": "The 'kind' of connector"
          }
        }
      },
      "Capability": {
        "type": "string",
        "description": "Capabilities a connector can expose to the viewer.",
        "enum": [
          "execute_sql",
          "list"
        ]
      },
      "ClickHouseCompression": {
        "type": "string",
        "description": "Compression options for `ClickHouse` tables.",
        "enum": [
          "none",
          "lz4",
          "zstd"
        ]
      },
      "ClickHouseConfig": {
        "type": "object",
        "description": "Additional ClickHouse-specific configuration.",
        "properties": {
          "compression": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/ClickHouseCompression"
              }
            ]
          },
          "settings": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            },
            "propertyNames": {
              "type": "string"
            }
          }
        }
      },
      "ConnectionDetailsRequest": {
        "type": "object",
        "description": "Request for multiple connection details",
        "required": [
          "connectors"
        ],
        "properties": {
          "connectors": {
            "type": "object",
            "description": "IDs -> searches of each connector to list",
            "additionalProperties": {
              "$ref": "#/components/schemas/ConnectionSearchQuery"
            },
            "propertyNames": {
              "type": "string"
            }
          },
          "fail_on_error": {
            "type": "boolean",
            "description": "Whether one failure should fail the entire request"
          }
        }
      },
      "ConnectionDetailsResponse": {
        "type": "object",
        "description": "Response to execute a SQL query",
        "required": [
          "connections"
        ],
        "properties": {
          "connections": {
            "type": "object",
            "description": "IDs -> `ListSummary` of each connector to list",
            "additionalProperties": {
              "$ref": "#/components/schemas/ListSummary"
            },
            "propertyNames": {
              "type": "string"
            }
          }
        }
      },
      "ConnectionKind": {
        "oneOf": [
          {
            "type": "string",
            "enum": [
              "object_store"
            ]
          },
          {
            "type": "string",
            "enum": [
              "database"
            ]
          },
          {
            "type": "object",
            "required": [
              "other"
            ],
            "properties": {
              "other": {
                "type": "string"
              }
            }
          }
        ],
        "description": "The types of connectors supported"
      },
      "ConnectionMetadata": {
        "type": "object",
        "description": "Runtime metadata describing a connector instance.\n\nA connection refers to a connector in the context of the underlying query engine.",
        "required": [
          "id",
          "name",
          "metadata"
        ],
        "properties": {
          "catalog": {
            "type": [
              "string",
              "null"
            ],
            "description": "The datafusion catalog the connector is registered in."
          },
          "id": {
            "type": "string"
          },
          "metadata": {
            "$ref": "#/components/schemas/BackendMetadata"
          },
          "name": {
            "type": "string"
          }
        }
      },
      "ConnectionOptions": {
        "type": "object",
        "description": "Common connection options shared by database connectors.",
        "required": [
          "endpoint",
          "username"
        ],
        "properties": {
          "check": {
            "type": "boolean",
            "description": "Whether the connector should validate connections before use",
            "default": false
          },
          "endpoint": {
            "type": "string",
            "description": "Endpoint, url, or path to the database"
          },
          "password": {
            "type": "string",
            "description": "Optional password for the database"
          },
          "tls": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/TlsOptions",
                "description": "TLS configuration if the database requires it"
              }
            ]
          },
          "username": {
            "type": "string",
            "description": "Username used to connect to the database"
          }
        }
      },
      "ConnectionSearchQuery": {
        "type": "object",
        "description": "Query param for searching connections",
        "properties": {
          "search": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "Database": {
        "oneOf": [
          {
            "type": "object",
            "required": [
              "click_house"
            ],
            "properties": {
              "click_house": {
                "oneOf": [
                  {
                    "type": "null"
                  },
                  {
                    "$ref": "#/components/schemas/ClickHouseConfig"
                  }
                ]
              }
            }
          }
        ],
        "description": "Supported databases for the default backend lineup.\n\nDefault implementations will be provided and over time the list will grow. For that reason, this\nenum is marked as `non_exhaustive`."
      },
      "DatabaseConfiguration": {
        "type": "object",
        "description": "Configuration for database-backed connectors.",
        "required": [
          "options",
          "driver"
        ],
        "properties": {
          "driver": {
            "$ref": "#/components/schemas/Database"
          },
          "options": {
            "$ref": "#/components/schemas/ConnectionOptions"
          },
          "pool": {
            "$ref": "#/components/schemas/PoolOptions"
          }
        }
      },
      "ListSummary": {
        "oneOf": [
          {
            "type": "object",
            "required": [
              "summary",
              "type"
            ],
            "properties": {
              "summary": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "type": {
                "type": "string",
                "enum": [
                  "databases"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "summary",
              "type"
            ],
            "properties": {
              "summary": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/TableSummary"
                }
              },
              "type": {
                "type": "string",
                "enum": [
                  "tables"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "summary",
              "type"
            ],
            "properties": {
              "summary": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "type": {
                "type": "string",
                "enum": [
                  "paths"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "summary",
              "type"
            ],
            "properties": {
              "summary": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/TableSummary"
                }
              },
              "type": {
                "type": "string",
                "enum": [
                  "files"
                ]
              }
            }
          }
        ],
        "description": "Summaries provided by listing"
      },
      "ObjectStore": {
        "oneOf": [
          {
            "type": "object",
            "required": [
              "aws"
            ],
            "properties": {
              "aws": {
                "$ref": "#/components/schemas/ObjectStoreOptions"
              }
            }
          },
          {
            "type": "object",
            "required": [
              "gcp"
            ],
            "properties": {
              "gcp": {
                "$ref": "#/components/schemas/ObjectStoreOptions"
              }
            }
          },
          {
            "type": "object",
            "required": [
              "azure"
            ],
            "properties": {
              "azure": {
                "$ref": "#/components/schemas/ObjectStoreOptions"
              }
            }
          },
          {
            "type": "object",
            "required": [
              "local"
            ],
            "properties": {
              "local": {
                "$ref": "#/components/schemas/ObjectStoreOptions"
              }
            }
          }
        ],
        "description": "Supported object store providers."
      },
      "ObjectStoreConfiguration": {
        "type": "object",
        "description": "Configuration for an object store-backed connector.",
        "properties": {
          "format": {
            "$ref": "#/components/schemas/ObjectStoreFormat",
            "description": "The format to read/write within the store."
          },
          "store": {
            "$ref": "#/components/schemas/ObjectStore",
            "description": "Provider specific configuration for the store itself."
          }
        }
      },
      "ObjectStoreFormat": {
        "oneOf": [
          {
            "type": "object",
            "description": "Apache Parquet format with optional key/value overrides.",
            "required": [
              "parquet"
            ],
            "properties": {
              "parquet": {
                "type": [
                  "object",
                  "null"
                ],
                "description": "Apache Parquet format with optional key/value overrides.",
                "additionalProperties": {
                  "type": "string"
                },
                "propertyNames": {
                  "type": "string"
                }
              }
            }
          }
        ],
        "description": "Supported file formats for object-store connectors."
      },
      "ObjectStoreOptions": {
        "type": "object",
        "description": "Provider-agnostic object store settings.",
        "required": [
          "bucket"
        ],
        "properties": {
          "bucket": {
            "type": "string",
            "description": "*Required* bucket name (or base directory for local stores)."
          },
          "from_env": {
            "type": "boolean",
            "description": "Whether credentials should be resolved from environment variables."
          },
          "options": {
            "type": "object",
            "description": "Additional provider-specific configuration parameters.",
            "additionalProperties": {
              "type": "string"
            },
            "propertyNames": {
              "type": "string"
            }
          }
        }
      },
      "PoolOptions": {
        "type": "object",
        "description": "Common configuration options shared across connector types.",
        "properties": {
          "connect_timeout": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32",
            "minimum": 0
          },
          "pool_size": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32",
            "description": "Configure the maximum number of connections to the database. Note, not all connectors\nsupport pools.",
            "minimum": 0
          },
          "transaction_timeout": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32",
            "minimum": 0
          }
        }
      },
      "QueryRequest": {
        "type": "object",
        "description": "Request to execute a SQL query",
        "required": [
          "sql"
        ],
        "properties": {
          "connector_id": {
            "type": [
              "string",
              "null"
            ],
            "description": "ID of the connector to use"
          },
          "sql": {
            "type": "string",
            "description": "SQL query to execute (can use URL tables like `s3://bucket/path/*.parquet`)"
          }
        }
      },
      "Secret": {
        "type": "string",
        "description": "Newtype to protect secrets from being logged\nA wrapper type for sensitive string data like passwords.\n\nThis type provides protection against accidental exposure of sensitive data\nin logs, debug output, or error messages. The inner value is not displayed\nin `Debug` implementations.\n\n# Example\n```\nuse stately_arrow::database::Secret;\n\nlet password = Secret::new(\"my_password\");\nprintln!(\"{password:?}\"); // Prints: Secret(*******)\n```"
      },
      "SessionCapability": {
        "type": "string",
        "description": "Session capabilities a `QuerySession` can expose to the `QueryContext`.",
        "enum": [
          "execute_without_connector"
        ]
      },
      "String": {
        "type": "string"
      },
      "TableSummary": {
        "type": "object",
        "description": "Lightweight description of a table/file exposed by a connector.",
        "required": [
          "name"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "rows": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          },
          "size_bytes": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "TlsOptions": {
        "type": "object",
        "description": "TLS options for databases that require secure connections.",
        "properties": {
          "cafile": {
            "type": [
              "string",
              "null"
            ]
          },
          "domain": {
            "type": [
              "string",
              "null"
            ]
          },
          "enable": {
            "type": "boolean",
            "default": false
          }
        }
      }
    },
    "responses": {
      "ConnectionDetailsResponse": {
        "description": "Response to execute a SQL query",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "description": "Response to execute a SQL query",
              "required": [
                "connections"
              ],
              "properties": {
                "connections": {
                  "type": "object",
                  "description": "IDs -> `ListSummary` of each connector to list",
                  "additionalProperties": {
                    "$ref": "#/components/schemas/ListSummary"
                  },
                  "propertyNames": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      },
      "ListSummary": {
        "description": "Summaries provided by listing",
        "content": {
          "application/json": {
            "schema": {
              "oneOf": [
                {
                  "type": "object",
                  "required": [
                    "summary",
                    "type"
                  ],
                  "properties": {
                    "summary": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "type": {
                      "type": "string",
                      "enum": [
                        "databases"
                      ]
                    }
                  }
                },
                {
                  "type": "object",
                  "required": [
                    "summary",
                    "type"
                  ],
                  "properties": {
                    "summary": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/TableSummary"
                      }
                    },
                    "type": {
                      "type": "string",
                      "enum": [
                        "tables"
                      ]
                    }
                  }
                },
                {
                  "type": "object",
                  "required": [
                    "summary",
                    "type"
                  ],
                  "properties": {
                    "summary": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "type": {
                      "type": "string",
                      "enum": [
                        "paths"
                      ]
                    }
                  }
                },
                {
                  "type": "object",
                  "required": [
                    "summary",
                    "type"
                  ],
                  "properties": {
                    "summary": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/TableSummary"
                      }
                    },
                    "type": {
                      "type": "string",
                      "enum": [
                        "files"
                      ]
                    }
                  }
                }
              ],
              "description": "Summaries provided by listing"
            }
          }
        }
      },
      "TableSummary": {
        "description": "Lightweight description of a table/file exposed by a connector.",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "description": "Lightweight description of a table/file exposed by a connector.",
              "required": [
                "name"
              ],
              "properties": {
                "name": {
                  "type": "string"
                },
                "rows": {
                  "type": [
                    "integer",
                    "null"
                  ],
                  "format": "int64",
                  "minimum": 0
                },
                "size_bytes": {
                  "type": [
                    "integer",
                    "null"
                  ],
                  "format": "int64",
                  "minimum": 0
                }
              }
            }
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "arrow",
      "description": "Arrow data endpoints"
    }
  ]
}